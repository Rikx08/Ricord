<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ricord</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'main/css/main_channel_style.css' %}" >
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <aside class="servers">
            <div class="server" onclick="location.href='{% url 'home' %}'">üè†</div>
            <div class="server">üéÆ</div>
            <div class="server">üéµ</div>
            <div class="server" onclick="location.href='{% url 'channel' %}'">üíª</div>
        </aside>
        <aside class="channels">
            <h2>–ö–∞–Ω–∞–ª—ã</h2>
            <ul>
                <li># –æ–±—â–∏–π</li>
                <li># –º–µ–º—ã</li>
                <li># –º—É–∑—ã–∫–∞</li>
                <li># —á–∞—Ç–∏–∫</li>
            </ul>
        <div class="line"></div>
            <div class="friends-list-container">
                    <section class="friends-list">
                        <div class="friend online"> –û—Å–Ω–æ–≤–Ω–æ–π</div>
                        <div class="friend offline"> –∫–ª–∞—Å–∏–∫–∞ 100</div>
                        <div class="friend online"> –ø–æ—Å–∏–¥–µ–ª–∫–∏</div>
                    </section>
                </div>
            <div class="nav_niz">
            <div class="voice-chat">
                <div class="title">–ì–æ–ª–æ—Å–æ–≤–∞—è —Å–≤—è–∑—å –ø–æ–¥</div>
                <div class="subtitle">—Å–µ—Å–±–∏–π—Å–∫–∏–π –ª–µ–∫—Å / –£–¢–û–ü–ò–Ø</div>
                <div class="voice-controls">
                    <button>‚úèÔ∏è</button>
                    <button>üì∑</button>
                    <button>‚òÄÔ∏è</button>
                </div>
            </div>
            <div class="user-panel">
                <div class="user-info">
                    <button class="user-button" onclick="location.href='{% url 'profile' %}'">
                    <img src="{% static 'media/avatars/default.jpg' %}" alt="–ê–≤–∞—Ç–∞—Ä">
                    <div class="username">{{ user.username }}</div>
                    </button>
                </div>
                <div class="user-controls">
                    <button>üíÄ</button>

                    <form action="{% url 'logout' %}" method="post">
                        {% csrf_token %}
                    <button type="submit">üé§</button>
                    </form>

                    <button>‚öôÔ∏è</button>
                </div>
            </div>
        </div>
        </aside>
        <main class="chat">
            <header>–û–±—â–∏–π —á–∞—Ç</header>
            <section class="messages" id="messages"></section>
            <div class="messageInput">
                <input id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" />
                <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </main>
        <aside class="users">
            <h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <ul>
                <li>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å1</li>
                <li>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å2</li>
                <li>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å3</li>
            </ul>
        </aside>
    </div>

    <script>
        var socket = io('http://localhost:5000', {
    extraHeaders: {
        "User-Id": {{ user.id }}
        }
    });
        function scrollToBottom() {
        var messages = document.getElementById('messages');
        requestAnimationFrame(() => {
            messages.scrollTop = messages.scrollHeight;
        });
    }
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('message', function (data) {
            var messages = document.getElementById('messages');
            var item = document.createElement('div');
            item.classList.add('message');

            // –°–æ–∑–¥–∞–µ–º –∞–≤–∞—Ç–∞—Ä (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ø—É—Ç—å)
            var avatar = document.createElement('img');
            avatar.src = "{% static 'media/avatars/default.jpg' %}";
            avatar.classList.add('avatar');

            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–∞
            var content = document.createElement('div');
            content.classList.add('content');

            // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            var username = document.createElement('div');
            username.classList.add('username');
            username.textContent = data.split(":")[0];

            // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            var text = document.createElement('div');
            text.classList.add('text');
            text.textContent = data.split(":")[1];

            content.appendChild(username);
            content.appendChild(text);

            item.appendChild(avatar);
            item.appendChild(content);
            messages.appendChild(item);

            scrollToBottom();
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            var messageInput = document.getElementById('messageInput');
            var message = messageInput.value.trim(); // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ

            if (message === "") return; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

            socket.emit('message', message);

            var messages = document.getElementById('messages');
            var item = document.createElement('div');
            item.classList.add('message', 'self-message'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

            // –°–æ–∑–¥–∞–µ–º –∞–≤–∞—Ç–∞—Ä (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å)
            var avatar = document.createElement('img');
            avatar.src = "{% static 'media/avatars/default.jpg' %}";
            avatar.classList.add('avatar');

            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–∞
            var content = document.createElement('div');
            content.classList.add('content');

            // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            var username = document.createElement('div');
            username.classList.add('username');
            username.textContent = "–í—ã";

            // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            var text = document.createElement('div');
            text.classList.add('text');
            text.textContent = message;

            content.appendChild(username);
            content.appendChild(text);

            item.appendChild(avatar);
            item.appendChild(content);
            messages.appendChild(item);

            scrollToBottom(); // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑

            messageInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
        }
    </script>

</body>
</html>






